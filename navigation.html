<nav class="navbar navbar-expand-sm" style="background-color: rgba(190, 214, 213, .0); z-index: 0;" id="ournav"
    hx-target="#anchor">

    <div class="container">
        <button class="navbar-toggler navbar-dark" style="color: white" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarText" aria-controls="navbarText" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" style="text-align-last: center; font-size: medium;" id="navbarText">
            <ul class="navbar-nav nav-fill w-100" style="display: contents;" id="navlist">
                <!--<li class="nav-item"><img src='assets/favicon-32x32.png' alt="tfl-logo" /></li>-->
                <li class="nav-item navCustomItem"><a class="nav-link" href="/calendar"
                        style="color: rgb(200, 210, 230)">calendar</a>
                </li>
                <li class="nav-item navCustomItem"><a class="nav-link" href="/groupchat"
                        style="color: rgb(200, 210, 230)">chat</a>
                </li>
                <li class="nav-item navCustomItem"><a class="nav-link" href="/posts"
                        style="color: rgb(200, 210, 230)">posts</a></li>
                <li class="nav-item navCustomItem"><a class="nav-link dropdown-toggle" href="#" role="button"
                        data-bs-toggle="dropdown" aria-expanded="false" style="color: rgb(200, 210, 230)">
                        games
                    </a>
                    <ul class="dropdown-menu" style="left: auto;">
                        <li><a class="dropdown-item my-2 py-2" href="/games/simple-shades"
                                style="background-color: rgb(99 81 95 / 15%);">Simple
                                Shades</a></li>
                        <li><a class="dropdown-item my-2 py-2" href="/games/stackerz"
                                style="background-color: rgb(99 81 95 / 15%);">Stackerz</a></li>
                    </ul>
                </li>
                <li class="nav-item navCustomItem"><a class="nav-link" href="/bugreport"
                        style="color: rgb(200, 210, 230)">report an
                        issue</a></li>
                <!--<li><button onclick="sendMessageToWorker()">Testme</button></li>-->
                <li class="nav-item" id="navitemforwelcome"><button id="loginlogoutnav" class="nav-link"
                        onclick='{loginModal.toggle(); showLoginForm()}'>login</button>
                </li>
            </ul>
        </div>
        <!--<p onclick='scrollToTop()' class="btn" hx-get="/get-posts" style="display: contents;" hx-trigger="click"
            hx-target="#post-items" style="color: blue;" id="notification"></p>-->
    </div>
</nav>
<div class="modal customModalTrans" tabindex="-1" id="changepfpmodal" aria-labelledby="openchangepfpmodal"
    aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content p-3" style="border-radius: 15px / 15px; background-color: rgb(99 81 255 / 65%);">
            <div class="modal-header p-2 my-1" id="changepfpheader"
                style="display: block; background-color: white; border-radius: 15px / 15px;">
                <h4 class="modal-title" style="text-align: center;">Change profile picture</h4>
            </div>
            <form hx-encoding="multipart/form-data" class="form modal-content border-0" hx-post="/update-pfp"
                hx-swap="none" id="updatepfpform" style="padding: 5%; border-radius: 15px / 15px;">
                <input id="pfpchangeinput" type="file" class="my-2" name="changepfp" placeholder="Upload new pfp"
                    accept="image/*" oninput="checkPfpChangeValidity()" />
                <input style="display: none;" name="usernameinput" id="invisibleusernameinput" />
                <button id="changePfpSubmitBtn" disabled class="btn btn-outline-success col my-2">change</button>
                <button type="button" class="btn btn-dark col my-2" data-bs-dismiss="modal">close</button><br />
            </form>
        </div>
    </div>
</div>
<div class="modal customModalTrans" data-bs-backdrop="static" tabindex="-1" id="login-modal">
    <div class="modal-dialog">
        <div class="modal-content border-2"
            style="background-color: rgb(146 255 231 / 89%); border-radius: 15px / 15px; box-shadow: 2px 2px 6px 0px;">
            <div class="modal-header" id="login-modal-header" style="display: block;">
                <h4 id="loginModalHeader" class="modal-title" style="text-align: center;">Login or Sign Up</h4>

                <!--<button id="modalclose" type="button" class="btn-close" data-bs-dismiss="modal"
                    aria-label="Close"></button>-->
            </div>
            <div class="modal-body">

                <div style="display: flex; justify-content: space-around;">
                    <button class="btn px-5 btn-outline-secondary" id="login-button"
                        onclick='showLoginForm()'>Login</button>
                    <button class="btn px-5 btn-outline-secondary" id="signup-button"
                        onclick='showSignUpForm()'>Sign-up</button>
                </div>
                <div id="togglesignuplogin">
                    <form id="resetPassForm" style="display: none" class="form" hx-swap="none"
                        hx-post="/reset-password-with-code"
                        hx-vals="js:{'user': usernameToResetPass, 'email': emailToResetPass}"
                        hx-on::after-request="afterResetRequest(event)" hx-indicator="#loadingspinner">
                        <input style="display: none;" type="text" autocomplete="username" placeholder="username" />
                        <div class="p-4">
                            <label>New Password:</label>
                            <input class="form-control" type="password" name="resetnewpassinput"
                                autocomplete="new-password" placeholder="Password"
                                oninput="checkForValidResetPassChange()" required id="resetnewpassin" />
                        </div>
                        <div class="p-4">
                            <label>Confirm New Password:</label>
                            <input class="form-control" type="password" autocomplete="new-password"
                                placeholder="Password" oninput="checkForValidResetPassChange()" required
                                id="resetconfirmnewpassin" name="resetconfirmnewpassinput" />
                        </div>
                        <div class="p-4">
                            <label>Reset Code:</label>
                            <input class="form-control" type="text" maxlength="6" placeholder="000000" required
                                id="resetCodeIn" name="resetCodeInput" />
                        </div>
                    </form>
                    <form class="form" style="display: none; z-index: 5;" name="changeAdminPassForm"
                        id="changeAdminPassForm" hx-post="/update-admin-pass"
                        hx-vals="js:{'username': document.getElementById('usernamelogininput').value}" hx-ext="json-enc"
                        hx-trigger="submit" hx-swap="none" hx-indicator="#loadingspinner">
                        <input style="display: none;" type="text" autocomplete="username" placeholder="username" />
                        <div class="p-4">
                            <label>New Password:</label>
                            <input class="form-control" type="password" name="newadminpassinput"
                                autocomplete="new-password" placeholder="Password"
                                oninput="checkForValidAdminPassChange()" required id="newadminpassin" />
                        </div>
                        <div class="p-4">
                            <label>Confirm New Password:</label>
                            <input class="form-control" type="password" autocomplete="new-password"
                                placeholder="Password" oninput="checkForValidAdminPassChange()" required
                                id="confirmnewadminpassin" name="confirmnewadminpassinput" />
                        </div>
                    </form>
                    <form class="form" id="login-form" name="loginform" hx-post="/login" hx-trigger="submit"
                        hx-on="loginevent: loginFunction()" hx-swap="none" hx-indicator="#loadingspinner">
                        <div class="p-4">
                            <h5>Login</h5>
                            <label>Username or email:</label>
                            <input class="form-control" autocomplete="username" type="text" style="width: 100%"
                                name="usernamelogin" placeholder="Username or email"
                                oninput="checkForValidLoginSubmission()" required id="usernamelogininput" />
                        </div>
                        <div class="p-4">
                            <label>Password:</label>
                            <input class="form-control" style="width: 100%" name="passwordlogin" type="password"
                                autocomplete="new-password" placeholder="Password"
                                oninput="checkForValidLoginSubmission()" required id="passwordlogininput" />
                        </div>
                        <a hx-prompt="What is your email associated with the account?" hx-post="/reset-password"
                            hx-ext="json-enc" hx-on::after-request="showResetLink(event)" hx-swap="none"
                            style="right: 20%; position: relative; left: 65%" class="link" id="resetPassLink">forgot
                            password</a>
                    </form>
                    <form class="form" hx-post="/signup" id="sign-up-form" hx-trigger="submit"
                        hx-encoding="multipart/form-data" hx-swap="none" hx-target="this"
                        hx-indicator="#loadingspinner">
                        <div class="p-4">
                            <h5>Sign Up</h5>
                            <label for="usernamesignup">Username:</label>
                            <input class="form-control" autocomplete="username" type="text" name="usernamesignup"
                                placeholder="Username" oninput="checkForValidSignUpSubmission()" required
                                id="usernamesignupinput" />
                        </div>
                        <div class="p-4">
                            <label for="emailsignup">Email:</label>
                            <input class="form-control" type="email" name="emailsignup" autocomplete="email"
                                placeholder="email@example.com" oninput="checkForValidSignUpSubmission()" required
                                id="emailsignupinput" maxlength="64" />
                        </div>
                        <div class="p-4">
                            <label>Password:</label>
                            <input class="form-control" type="password" name="passwordsignup"
                                autocomplete="new-password" placeholder="Password"
                                oninput="checkForValidSignUpSubmission()" required id="passwordsignupinput" />
                        </div>
                        <div class="p-4">
                            <label>Confirm Password:</label>
                            <input class="form-control" type="password" autocomplete="new-password"
                                placeholder="Password" oninput="checkForValidSignUpSubmission()" required
                                id="confirmpasswordsignupinput" name="confirmpasswordsignup" />
                            <p id="passworddonotmatch" style="color: red;"></p>
                        </div>
                        <div class="p-4">
                            <label>Family Passcode (Ask your admin for this):</label>
                            <input class="form-control" type="text" placeholder="familyname_123abc234"
                                oninput="checkForValidSignUpSubmission()" required id="orgidinput" name="orgidinput" />
                        </div>
                        <div class="p-4">

                            <label>Pick a profile picture</label>
                            <input class="form-control" id="pfpimage" type="file" accept="image/*"
                                oninput="checkForValidSignUpSubmission()" name="pfpformfile" required />

                        </div>

                    </form>
                </div>

            </div>

        </div>
    </div>

</div>


<script>
    var changePfpModal = new bootstrap.Modal(document.getElementById('changepfpmodal'), {});
    let p = document.getElementById('anchor')
    let c = document.getElementById('ournav')

    var usernameToResetPass = null
    var emailToResetPass = null
    var signup = document.getElementById('sign-up-form')
    var loginele = document.getElementById('login-form')
    const changeAdminPassForm = document.getElementById('changeAdminPassForm')
    const changePassForm = document.getElementById('resetPassForm')
    let parentauth = document.getElementById('togglesignuplogin')
    //let parentauth = document.getElementById('loginSignupForm')
    let loginbtn = document.getElementById('login-button')
    let signupbtn = document.getElementById('signup-button')

    let gologin = document.createElement('button')
    let gosignup = document.createElement('button')

    let usernamelogininput = document.getElementById('usernamelogininput')
    let passwordlogininput = document.getElementById('passwordlogininput')

    let changeAdminPassIn = document.getElementById('newadminpassin')
    let confirmChangeAdminPassIn = document.getElementById('confirmnewadminpassin')
    let changeResetPassIn = document.getElementById('resetnewpassin')
    let confirmChangeResetPassIn = document.getElementById('resetconfirmnewpassin')

    let usernamesignupinput = document.getElementById('usernamesignupinput')
    let emailsignupinput = document.getElementById("emailsignupinput")
    let passwordsignupinput = document.getElementById('passwordsignupinput')
    let confirmpasswordsignupinput = document.getElementById('confirmpasswordsignupinput')

    var loginModal = new bootstrap.Modal(document.getElementById('login-modal'), {});

    var pfpChangeInput = document.getElementById('pfpchangeinput')
    var pfpChangeBtn = document.getElementById('changePfpSubmitBtn')
    var updatePfpForm = document.getElementById('updatepfpform')
    var invisibleInputForUsername = document.getElementById('invisibleusernameinput')

    var navbarItems = document.getElementById('navbarText')

    var navItemToReplace = document.getElementById('navitemforwelcome')
    var navInnerToReplace = document.getElementById('loginlogoutnav')

    const adminPassSubmitBtn = document.createElement('button')
    const resetPassSubmitBtn = document.createElement('button')

    const logoutButton = document.createElement('button')
    logoutButton.setAttribute("class", "btn btn-secondary")
    logoutButton.setAttribute("id", "logoutButtonOnNav")
    //logoutButton.setAttribute("onclick", 'logoutFunction()')
    logoutButton.innerHTML = "Logout"

    const navItemWelcome = document.createElement('li')
    const divToStickNav = document.createElement('div')
    divToStickNav.setAttribute("style", "display: contents;")

    navItemWelcome.setAttribute("class", "nav-item")

    const navItemWelcomeAvatar = document.createElement('img')
    navItemWelcomeAvatar.setAttribute("class", "border-0 mx-3")
    // clip-path: inset(30px 7px 30px 7px round 100%)
    navItemWelcomeAvatar.setAttribute("style", "width: 8%; height: auto; border-radius: 35%;")
    navItemWelcomeAvatar.setAttribute("id", "pfpavatar")
    navItemWelcomeAvatar.setAttribute("alt", "Click here to change")

    var username = ''

    p.append(c)
    async function fetchSeshDetails() {

        const resp = await fetch("/get-username-from-session", {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        })

        const text = await resp.json()

        username = text.Username
        chatTheme = text.BGtheme
        gchatOrderOpt = text.GchatOrderOpt
        cfDomain = text.CFDomain

        if (cfDomain <= "") {
            navItemWelcomeAvatar.setAttribute("src", "")
        }

        text.Username.length < 1
            ? logoutFunction()
            : navItemWelcomeAvatar.setAttribute("src", "https://" + cfDomain + "/pfp/" + text.Pfpname)
        return text
    }


    navItemWelcomeAvatar.addEventListener('click', showPfpModal = async (event) => {
        changePfpModal.show()
    })
    if (window.location.pathname == "/groupchat")
        navItemWelcomeAvatar.removeEventListener("click", showPfpModal)

    /*p.addEventListener("scroll", function () {
        console.log("scroll")
        document.getElementById('toggleNavItems').dispatchEvent(new Event('click'))
    })*/
    function checkPfpChangeValidity() {

        invisibleInputForUsername.value = username
        if (pfpChangeInput.value.length > 1) {
            document.getElementById("changePfpSubmitBtn").disabled = false
            pfpChangeBtn.className = "btn btn-success col my-2"
        }

    }
    updatepfpform.addEventListener('htmx:afterRequest', async function setPfp(event) {
        pfpChangeBtn.setAttribute("disabled", "true")

        pfpChangeBtn.removeEventListener('click', setPfp)

        if (event.detail.xhr.status == 200)
            window.location.reload()
        else if (event.detail.xhr.status == 400)
            alert("Something was wrong with that picture :(")

    })
    function showResetLink(event) {
        if (event.detail.xhr.status == 400) {
            alert("Make sure you are using the correct email. You can only reset your password once every 24 hours.")
        }
        const parseJson = JSON.parse(event.detail.xhr.response)
        alert("Here is your reset code. Do not lose this code. It will expire in 10 minutes: " + parseJson.code)
        showChangePassForm(parseJson.user, parseJson.email)
    }
    function showChangePassForm(username, email) {
        changePassForm.style.display = "block"
        usernameToResetPass = username
        emailToResetPass = email
        loginbtn.disabled = true
        signupbtn.disabled = true
        loginele.style.display = "none"
        document.getElementById('loginModalHeader').innerHTML = "Change password"
    }
    loginele.addEventListener("changeAdminPassword", () => {
        alert("Please create a new personal password")
        loginbtn.disabled = true
        signupbtn.disabled = true
        document.getElementById('loginModalHeader').innerHTML = "Change password"
        document.getElementById('resetPassLink').remove()
        updateAdminPassword()
    })
    function updateAdminPassword() {

        loginModal.toggle()
        loginele.style.display = "none"
        changeAdminPassForm.style.display = "block"
    }
    function afterResetRequest(event) {
        if (event.detail.xhr.status == 200) {
            alert("Success")
            loginbtn.disabled = false
            signupbtn.disabled = false
            loginele.style.display = "block"
            changePassForm.style.display = "none"
            document.getElementById('loginModalHeader').innerHTML = "Login or Sign Up"
            showLoginForm();
        } else if (event.detail.xhr.status == 400) {
            alert("Unable to change your password. Please try again")
        } else if (event.detail.xhr.status == 401) {
            alert("Incorrect reset code")
        }

    }

    if (document.cookie.includes("session_id=")) {

        fetchSeshDetails()
        divToStickNav.append(navItemWelcomeAvatar)
        divToStickNav.append(logoutButton)

        document.getElementById('navlist').removeChild(navItemToReplace)

        navbarItems.append(divToStickNav)

    } else {

        loginModal.toggle()
        showLoginForm()
        //showSignUpForm()
        //document.getElementById('login-modal').setAttribute('data-bs-backdrop', 'static')
        //document.getElementById('login-modal').setAttribute('data-bs-keyboard', 'false')
        document.getElementById('login-modal-header').contains(document.getElementById('modalclose')) &&
            document.getElementById('login-modal-header').removeChild(document.getElementById('modalclose'))
    }

    document.addEventListener("onUnauthorizedEvent", () => {

        logoutFunction()
        //window.location.reload()
    })

    function checkForValidAdminPassChange() {


        adminPassSubmitBtn.setAttribute("class", "btn btn-success")
        adminPassSubmitBtn.setAttribute("type", "submit")
        adminPassSubmitBtn.innerHTML = "Change"

        if (changeAdminPassIn.value == confirmChangeAdminPassIn.value && changeAdminPassIn.value.length > 7) {
            changeAdminPassForm.append(adminPassSubmitBtn)
        } else if (changeAdminPassIn.value !== confirmChangeAdminPassIn.value && changeAdminPassForm.contains(adminPassSubmitBtn)) {

            changeAdminPassForm.removeChild(adminPassSubmitBtn)
        }

    }
    function checkForValidResetPassChange() {


        resetPassSubmitBtn.setAttribute("class", "btn btn-success")
        resetPassSubmitBtn.setAttribute("type", "submit")
        resetPassSubmitBtn.innerHTML = "Change"

        if (changeResetPassIn.value == confirmChangeResetPassIn.value && changeResetPassIn.value.length > 7) {
            changePassForm.append(resetPassSubmitBtn)
        } else if (changeAdminPassIn.value !== confirmChangeResetPassIn.value && changePassForm.contains(resetPassSubmitBtn)) {

            changePassForm.removeChild(resetPassSubmitBtn)
        }

    }
    function checkForValidLoginSubmission() {

        if (usernamelogininput.value > '' && passwordlogininput.value > '') {

            gologin.setAttribute("type", "submit")
            gologin.setAttribute("id", 'logingobutton')
            gologin.setAttribute("class", "btn btn-success")
            gologin.setAttribute("data-bs-dismiss", "modal")
            gologin.style.position = "relative"
            gologin.style.right = "25%"
            gologin.style.width = "25%"
            gologin.innerHTML = "Go!"

            loginele.append(gologin)
        } else if ((usernamelogininput.value == '' || passwordlogininput.value == '') && loginele.contains(gologin)) {
            loginele.removeChild(gologin)
        }
    }
    function checkForValidSignUpSubmission() {
        if (usernamesignupinput.value > '' && passwordsignupinput.value > '' && passwordsignupinput.value === confirmpasswordsignupinput.value && document.getElementById('orgidinput').value.length > 1 && passwordsignupinput.value.length > 7 && confirmpasswordsignupinput.value.length > 7 && emailsignupinput.value.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)) {
            gosignup.setAttribute("type", "submit")
            gosignup.setAttribute("id", 'signupgobutton')
            gosignup.setAttribute("class", "btn btn-outline-success")
            gosignup.setAttribute("data-bs-dismiss", "modal")

            gosignup.innerHTML = "Go!"
            if (passwordsignupinput.value !== confirmpasswordsignupinput.value) {
                document.getElementById('passworddonotmatch').innerHTML = "Passwords do not match!"
                if (signup.contains(gosignup))
                    signup.removeChild(gosignup)
            } else
                document.getElementById('passworddonotmatch').innerHTML = ""

            signup.append(gosignup)

        } else if (passwordsignupinput.value !== confirmpasswordsignupinput.value && usernamesignupinput.value == '' || emailsignupinput.value == '' || passwordsignupinput.value == '' || confirmpasswordsignupinput.value == '' || !emailsignupinput.value.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)) {

            if (passwordsignupinput.value !== confirmpasswordsignupinput.value)
                document.getElementById('passworddonotmatch').innerHTML = "Passwords do not match!"
            else
                document.getElementById('passworddonotmatch').innerHTML = ""
            if (signup.contains(gosignup))
                signup.removeChild(gosignup)

        }
    }

    function showSignUpForm() {

        if (parentauth.childElementCount >= 1) {
            signupbtn.setAttribute('class', 'btn px-5 btn-secondary')


            loginbtn.setAttribute('class', 'btn px-5 btn-outline-secondary')
            signup.setAttribute("style", "display: inherit")
            //parentauth.appendChild(signup)
            if (parentauth.contains(loginele)) {
                parentauth.removeChild(loginele)
            }
        }

    }
    htmx.on("#sign-up-form", "htmx:afterRequest", function (event) {

        if (event.detail.xhr.status == 400) {
            alert("Are you trying to bypass client side validation??!?!?!")
        } else if (event.detail.xhr.status == 401) {
            alert("You have an incorrect family passcode. Please confirm this with your plan administrator")
            loginModal.toggle();
            showSignUpForm()

        } else if (event.detail.xhr.status == 200) {
            alert('Sign up Successful! You can now login');
            loginModal.toggle();
            showLoginForm();
        } else if (event.detail.xhr.status == 400) {
            alert("Something was wrong with the picture you provided. Try a different one")
        } else if (event.detail.xhr.status == 409) {
            alert("That email already exists")
            window.location.reload()
        } else if (event.detail.xhr.status == 424) {
            alert("Sign up failed. Your family loop has reached it maximum allowed amount of users. Please reach out to your account administrator.")
            window.location.reload()
        }

    })
    function showLoginForm() {
        if (parentauth.childElementCount >= 1) {
            loginbtn.setAttribute('class', 'btn px-5 btn-secondary')
            signupbtn.setAttribute('class', 'btn px-5 btn-outline-secondary')
            if (parentauth.contains(signup)) {
                //parentauth.removeChild(signup)
                signup.setAttribute("style", "display: none")
            }

            parentauth.appendChild(loginele)
        }
    }


    function loginFunction() {
        alert("username or password incorrect")

        loginModal.toggle()
        showLoginForm()
    }

</script>
<script type="module">
    import app from "/js/init-firebase.js"
    import { logoutFunction } from "/js/globalFunctions.js"
    import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-messaging.js";
    const messaging = getMessaging(app);
    document.getElementById("logoutButtonOnNav") ?
        document.getElementById("logoutButtonOnNav").addEventListener("click", logoutFunction)
        :
        console.log("element not found")
    /* var notificationBody = {}
     const checkSubResp = await fetch('/get-check-if-subscribed', {
         method: "GET",
         headers: {
             "Content-Type": "application/json"
         }
     }).then((data) => {
 
         if (data.status == 202) {
             if (!("Notification" in window)) {
                 // Check if the browser supports notifications
                 alert("This browser does not support desktop notification");
             } else {
 
                 Notification.requestPermission().then((res) => {
 
                     if (Notification.permission == 'granted') {
 
                         getToken(messaging, { vapidKey: "BJmKY269Mkqw_zRnXy0n1ncFOBsamgi7hSpli4hKGlAJ-OKTae7qj8scasqrO9dpdmntNXXgbsMK3okY0bpOBVQ" })
                             .then((currentToken) => {
 
                                 notificationBody = {
                                     fcm_token: currentToken
                                 }
                                 fetch("/create-subscription", {
                                     method: "POST",
                                     headers: {
                                         "Content-Type": "application/json"
                                     },
                                     body: JSON.stringify(notificationBody)
                                 })
                                     .then(() => {
                                         return window.navigator.serviceWorker
                                             .getRegistration('/firebase-cloud-messaging-push-scope')
                                             .then((serviceWorker) => {
                                                 if (serviceWorker) return serviceWorker;
                                                 return window.navigator.serviceWorker.register('/firebase-messaging-sw.js', {
                                                     scope: '/firebase-cloud-messaging-push-scope',
                                                 });
                                             });
                                     })
                             })
                     }
 
                 })
             }
         }
     }).catch((err) => console.log(JSON.stringify(err)))*/
    //}
    //}




</script>