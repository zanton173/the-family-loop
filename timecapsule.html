<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height, initial-scale=1.0">
    <link rel="manifest" href="assets/manifest.json" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom-css.css" rel="stylesheet">
    <link href="css/font-css.css" rel="stylesheet">
    <link href="404.html" rel="stylesheet">
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/htmx.min.js"></script>
    <script src="js/htmx_json-enc.js"></script>
    <script type="javascript" src="firebase-messaging-sw.js"></script>
    <title>Time Capsule</title>
</head>

<body style="background: linear-gradient(180deg, #00106e, #00ecff 55%); height: 100dvh">
    <div class="spinner-indicator" id="loadingspinner"
        style="width: 100%; height: 100%; background-color: rgb(197, 197, 197);">

        <img width="90px" height="90px" class="spinner-indicator" src="assets/LoadingSpinner.png" />
    </div>

    <img id="bannerimg" src="assets/TFLBannerW.png" alt="Welcome to TFL!"
        style="text-align: center; width: 35dvw; left: 50dvw; position: absolute; top: 0%" />


    <div class="sticky-top" id="anchor">

    </div>
    <header id="timecapheader">
        <p id="headerContent"
            style="text-align: center; color: white; padding-left: 4%; padding-right: 4%; padding-bottom: 0%;">
            Have you ever lost pictures from over the years or spent way too much time trying to find a specific video?
            Create a durable, digital time capsule to store pictures & video! Currently
            available
            for 1, 3 or 7 year periods.
        </p>
    </header>
    <div id="pageSelectionBanner"
        style="text-align: center; height: 35px; width: 100dvw; display: flex; justify-content: space-around; background-color: rgb(255 255 255 / 9%); border-width: thin; box-shadow: 1px 1px 3px black; align-content: center; flex-wrap: wrap;">
        <p onclick="switchActivePage()" style="margin-bottom: 0%">&lt;</p>
        <p id="currentPageSelector" style="margin-bottom: 0%; font-weight: 600;">
            Create a New Capsule!</p>
        <p onclick="switchActivePage()" style="margin-bottom: 0%">&gt;</p>
    </div>
    <div id="createNewCapsuleDiv">

        <form id="createCapsuleForm" class="d-inline-grid" hx-post="/create-new-tc" hx-encoding="multipart/form-data"
            hx-swap="none" hx-indicator="#loadingspinner"
            style="background-color: white; border-radius: 15px / 15px; padding: 3%; margin-top: 5%">
            <div style="display: block;">
                <h3>How long would you like to store your time capsule?</h3>
                <div class="form-check">

                    <label class="form-check-label" for="yearsToStoreInput">
                        <input class="form-check-input" type="radio" value="one_year" name="yearsToStore"
                            id="yearsToStoreInput" checked>
                        1 Year
                    </label>
                </div>
                <div class="form-check">
                    <label class="form-check-label" for="threeYearsToStore">
                        <input class="form-check-input" type="radio" value="three_years" name="yearsToStore"
                            id="threeYearsToStore">
                        3 Years
                    </label>
                </div>
                <div class="form-check">
                    <label class="form-check-label" for="yearsToStoreInputSeven">
                        <input class="form-check-input" type="radio" value="seven_years" name="yearsToStore"
                            id="yearsToStoreInputSeven">
                        7 Years
                    </label>
                </div>
            </div>
            <label for="tcfileinput">Choose what to put in your time capsule:</label>
            <input id="tcfileinput" name="tcfileinputname" class="my-2 shadow" oninput="checkValidityOfFiles()" multiple
                type="file" required style="width: 100%" name="file_name" accept="image/*,video/*"
                placeholder="Upload photos or video" />
            <p id="checkForFileListSize" style="color: red"></p>
            <button id="submitNewTCForm" class="btn btn-success" style="display: none" type="submit">Create!</button>
        </form>
    </div>
    <div id="myCapsulesDiv" style="display: none;">
        my current
    </div>

    <script>
        const createNewCapPage = document.getElementById('createNewCapsuleDiv')
        const usersCapsPage = document.getElementById('myCapsulesDiv')
        document.addEventListener('DOMContentLoaded', () => {

            document.getElementById('timecapheader').classList.add('fadeInOpacity')
        })
        function switchActivePage() {
            if (!createNewCapPage.style.display.includes("none")) {
                document.getElementById('currentPageSelector').innerHTML = "My Capsules"
                createNewCapPage.style.display = "none"
                usersCapsPage.style.display = ""
            } else {
                document.getElementById('currentPageSelector').innerHTML = "Create a New Capsule!"
                createNewCapPage.style.display = ""
                usersCapsPage.style.display = "none"
            }
        }
        function checkValidityOfFiles() {
            var curFileListSize = 0
            for (var i = 0; i < document.getElementById('tcfileinput').files.length; i++) {
                curFileListSize += Math.trunc(document.getElementById('tcfileinput').files[i].size / 1024 / 1024)
            }

            if (document.getElementById('tcfileinput').files.length > 0)
                document.getElementById('submitNewTCForm').style.display = ""
            else
                document.getElementById('submitNewTCForm').style.display = "none"

            if (curFileListSize > 16384) {
                document.getElementById('submitNewTCForm').disabled = true
                document.getElementById('checkForFileListSize').innerHTML = "File size limit is 16gb"
            } else {
                document.getElementById('submitNewTCForm').disabled = false
                document.getElementById('checkForFileListSize').innerHTML = ""
            }
        }
    </script>
</body>

</html>