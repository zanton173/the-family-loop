<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <script src="js/bootstrap.bundle.min.js"></script>
    <!--<script src="https://unpkg.com/htmx.org@1.9.5"
                integrity="sha384-xcuj3WpfgjlKF+FXhSQFQ0ZNr39ln+hwjN3npfM9VBnUskLolQAcN80McRIVOPuO"
                crossorigin="anonymous"></script>
                <script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>-->
    <script src="js/htmx.min.js"></script>
    <script src="js/htmx_json-enc.js"></script>
</head>
<div class="modal" data-bs-backdrop="static" tabindex="-1" id="login-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" style="text-align: center;">Login or Sign Up</h4>

            </div>
            <div class="modal-body">
                <div
                    style="display: flex; justify-content: space-around; width: 90%; margin-left: 5%; margin-right: 5%;">
                    <button class="btn px-2 btn-outline-secondary" id="login-button" onclick='showLoginForm()'>Login
                    </button>
                    <button class="btn px-2 btn-outline-secondary" id="signup-button"
                        onclick='showSignUpForm()'>Sign-up</button>
                </div>
                <div id="togglesignuplogin">
                    <form method="post" class="form" id="login-form" name="loginform" hx-post="/login"
                        hx-trigger="submit" hx-on="loginevent: loginFunction()" hx-swap="none">
                        <div class="p-4">
                            <h5>Login</h5>
                            <label>Username:</label>
                            <input class="form-control" autocomplete="username" type="text" style="width: 100%"
                                name="usernamelogin" placeholder="Username" oninput="checkForValidLoginSubmission()"
                                required id="usernamelogininput" />
                        </div>
                        <div class="p-4">
                            <label>Password:</label>
                            <input class="form-control" style="width: 100%" name="passwordlogin" type="password"
                                autocomplete="new-password" placeholder="Password"
                                oninput="checkForValidLoginSubmission()" required id="passwordlogininput" />
                        </div>
                    </form>
                    <form method="post" class="form" id="sign-up-form" name="signupform" hx-post="/signup"
                        hx-trigger="submit" hx-encoding="multipart/form-data" hx-swap="none">
                        <div class="p-4">
                            <h5>Sign Up</h5>
                            <label>Username:</label>
                            <input class="form-control" autocomplete="username" type="text" name="usernamesignup"
                                placeholder="Username" oninput="checkForValidSignUpSubmission()" required
                                id="usernamesignupinput" />
                        </div>
                        <div class="p-4">
                            <label>Password:</label>
                            <input class="form-control" type="password" name="passwordsignup"
                                autocomplete="new-password" placeholder="Password"
                                oninput="checkForValidSignUpSubmission()" required id="passwordsignupinput" />
                        </div>
                        <div class="p-4">
                            <label>Confirm Password:</label>
                            <input class="form-control" type="password" autocomplete="new-password"
                                placeholder="Password" oninput="checkForValidSignUpSubmission()" required
                                id="confirmpasswordsignupinput" name="confirmpasswordsignup" />
                        </div>
                        <div class="p-4">
                            <!-- TODO: Add required PFP -->
                            <label>Pick a profile picture</label>
                            <input id="pfpimage" type="file" accept="image/*" name="pfpformfile" required />

                        </div>
                    </form>
                </div>

            </div>

        </div>
    </div>

</div>
<script>
    var loginModal = new bootstrap.Modal(document.getElementById('login-modal'), {

    });

    let signup = document.getElementById('sign-up-form')
    let loginele = document.getElementById('login-form')
    let parentauth = document.getElementById('togglesignuplogin')

    let loginbtn = document.getElementById('login-button')
    let signupbtn = document.getElementById('signup-button')

    let gologin = document.createElement('button')
    let gosignup = document.createElement('button')

    let usernamelogininput = document.getElementById('usernamelogininput')
    let passwordlogininput = document.getElementById('passwordlogininput')

    let usernamesignupinput = document.getElementById('usernamesignupinput')
    let passwordsignupinput = document.getElementById('passwordsignupinput')
    let confirmpasswordsignupinput = document.getElementById('confirmpasswordsignupinput')
    loginModal.toggle()
    showLoginForm()

    function showSignUpForm() {

        //if (parentauth.childElementCount >= 1) {
        if (parentauth.contains(loginele)) {
            signupbtn.setAttribute('class', 'btn px-5 btn-secondary')

            loginbtn.setAttribute('class', 'btn px-5 btn-outline-secondary')
            parentauth.removeChild(loginele)
            parentauth.appendChild(signup)
        }
        //}
    }
    function showLoginForm() {

        //if (parentauth.childElementCount >= 1) {
        if (parentauth.contains(signup)) {
            loginbtn.setAttribute('class', 'btn px-5 btn-secondary')
            signupbtn.setAttribute('class', 'btn px-5 btn-outline-secondary')
            parentauth.removeChild(signup)
            parentauth.appendChild(loginele)
        }
        //}
    }
    function checkForValidLoginSubmission() {

        if (usernamelogininput.value > '' && passwordlogininput.value > '') {

            gologin.setAttribute("type", "submit")
            gologin.setAttribute("class", "btn btn-outline-success")
            gologin.setAttribute("data-bs-dismiss", "modal")

            gologin.innerHTML = "Go!"

            loginele.append(gologin)
        } else if ((usernamelogininput.value == '' || passwordlogininput.value == '') && loginele.contains(gologin)) {
            loginele.removeChild(gologin)
        }
    }
    function checkForValidSignUpSubmission() {
        if (usernamesignupinput.value > '' && passwordsignupinput.value > '' && passwordsignupinput.value === confirmpasswordsignupinput.value) {

            gosignup.setAttribute("type", "submit")
            gosignup.setAttribute("class", "btn btn-outline-success")
            gosignup.setAttribute("data-bs-dismiss", "modal")

            gosignup.innerHTML = "Go!"

            signup.append(gosignup)

        } else if ((usernamesignupinput.value == '' || passwordsignupinput.value == '' || confirmpasswordsignupinput.value == '' || passwordsignupinput.value !== confirmpasswordsignupinput.value) && signup.contains(gosignup)) {

            signup.removeChild(gosignup)

        }
    }
    function loginFunction() {
        alert("username or password incorrect")

        loginModal.toggle()
        showLoginForm()
    }


</script>