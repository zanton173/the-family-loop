<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <link rel="manifest" href="/assets/manifest.json" />
    <title>New Game</title>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>

    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/custom-css.min.css" rel="stylesheet">
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/htmx.min.js"></script>
    <script src="/js/htmx_json-enc.js"></script>
    <script src="/js/globalFunctions.js"></script>
</head>


<body id="newgamebody" style="overflow: hidden; position: absolute; top: 0; bottom: 0; touch-action: manipulation;">
    <!--<div id="gameNotAvailable">Game not available on this device size!
    </div>-->
    <div id="homeScreen" style="position: absolute; text-align: center; height: 100dvh; width: 100dvw; background-image: linear-gradient(to bottom,
            hsl(199, 90%, 65%),
            hsl(314, 100%, 73%))">
        <div style="height: inherit;">
            <div class="col h-100">
                <div class="row-gap-lg-5"
                    style="font-size: xx-large; margin-top: 10%; height: 15dvh; font-weight: bolder; font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif">
                    New Game
                </div>
                <div id="testconn">
                    <p id="connectionId" style="color: green"></p>
                    <input id="wsinput" type="text" style="width: 80dvw" /><button type="button" id="sendMessage"
                        onclick="sendMessage()">send</button>
                    <div id="wsoutput"></div>
                </div>
                <div class="row-gap-5 w-35 my-5 h-20">
                    <button class="btn btn-primary p-3"
                        style="border-radius: 18px / 18px; border-width: 3px; border-style: solid; border-color: darkslategray; font-size: larger"
                        onclick="showGameWindow()">start</button>
                </div>
                <div class="row-gap-5 w-35 my-5 h-20">
                    <button class="btn btn-primary p-3"
                        style="border-radius: 18px / 18px; border-width: 3px; border-style: solid; border-color: darkslategray; font-size: larger"
                        onclick="showLeaderboardWindow()">leaderboard</button>
                </div>
                <div class="row-gap-5 w-35 my-5 h-20">
                    <button class="btn btn-primary p-3"
                        style="border-radius: 18px / 18px; border-width: 3px; border-style: solid; border-color: darkslategray; font-size: larger"
                        onclick="location.href = '/'">tfl home</button>
                </div>

            </div>
        </div>
    </div>

    <script>
        var socket = null
        window.location.protocol === "https:" ? socket = new WebSocket(`wss://${window.location.host}/ws-endpoint`) : socket = new WebSocket(`ws://${window.location.host}:80/ws-endpoint`)

        socket.onopen = () => {
            document.getElementById('connectionId').innerText = "You are connected"
        }

        socket.onmessage = function (event) {
            console.log(event.data)
            var newmessage = document.createElement('p')
            newmessage.innerText = event.data
            document.getElementById('wsoutput').append(newmessage)
        }

        function sendMessage() {
            socket.send(document.getElementById('wsinput').value)
        }


    </script>
    <script type="module">

        import { logoutFunction } from "/js/globalFunctions.js"

        document.addEventListener("onUnauthorizedEvent", () => {

            logoutFunction()
            location.href = "../"
        })
    </script>
</body>

</html>